image: node:12

variables:
  SERVER_HOST: "157.230.227.3"
  WEBAPP_FOLDER: "/var/www/kengamis/"

before_script:
  - apt-get update -qq && apt-get install -y -qq unzip
  - apt-get install zip
  - apt-get install sshpass
  - cd client
  - npm install
  - npm install -g @angular/cli

deploy:
  artifacts:
    paths:
      - dist/
  stage: deploy
  only:
    - crvpf
  script:
    - ng build --prod --base-href kengamis
    - cd dist
    - sshpass -V
    - export SSHPASS=$USER_PASS
    - echo "Copying to server..."
    - sshpass -e scp -o stricthostkeychecking=no -r * root@$SERVER_HOST:$WEBAPP_FOLDER
    - echo "Done Deploying kengamis :)"


